/**
 * PgwSlider - Version 2.0
 *
 * Copyright 2014, Jonathan M. Piat
 * http://pgwjs.com - http://pagawa.com
 * 
 * Released under the GNU GPLv3 license - http://opensource.org/licenses/gpl-3.0
 */
(function(e){e.fn.pgwSlider=function(t){var n={mainClassName:"pgwSlider",listPosition:"right",selectionMode:"click",autoSlide:true,verticalCentering:false,beforeSlide:false,afterSlide:false,maxHeight:false,adaptiveHeight:false,adaptiveDuration:200,transitionDuration:600,intervalDuration:3e3};if(this.length==0){return this}else if(this.length>1){this.each(function(){e(this).pgwSlider(t)});return this}var r=this;r.plugin=this;r.data=[];r.config={};r.currentSlide=0;r.slideCount=0;r.eventInterval=null;r.eventResize=null;r.eventAdaptive=null;r.window=e(window);var i=function(){r.config=e.extend({},n,t);a();if(r.config.autoSlide){l()}return true};var s=function(e){var t={};var n=e.find("a").attr("href");if(typeof n!="undefined"&&n!=""){t.link=n;var r=e.find("a").attr("target");if(typeof r!="undefined"&&r!=""){t.linkTarget=r}}var i=e.find("img").attr("src");if(typeof i!="undefined"&&i!=""){t.thumbnail=i}var s=e.find("img").attr("data-large-src");if(typeof s!="undefined"&&s!=""){t.image=s}var o=e.find("span").text();if(typeof o!="undefined"&&o!=""&&o!=null){t.title=o}else{var u=e.find("img").attr("alt");if(typeof u!="undefined"&&u!=""){t.title=u}}var a=e.find("img").attr("data-description");if(typeof a!="undefined"&&a!=""){t.description=a}return t};var o=function(t,n){if(r.config.maxHeight){if(r.window.width()>480&&t>r.config.maxHeight){t=r.config.maxHeight}else if(r.window.width()<=480){if(t+r.plugin.find(".ps-list").height()>r.config.maxHeight){t=r.config.maxHeight-r.plugin.find(".ps-list").height()}}}var i=(t-(r.slideCount-1)*6)/r.slideCount;var s=100/r.slideCount;r.plugin.find(".ps-list > li").css({width:s+"%"});if(typeof n!="undefined"&&n&&r.config.maxHeight==false){clearTimeout(r.eventAdaptive);r.eventAdaptive=setTimeout(function(){if(typeof r.plugin.find(".ps-current").animate=="function"){r.plugin.find(".ps-current").animate({height:t},r.config.adaptiveDuration,function(){r.plugin.find(".ps-list > li").animate({height:i},r.config.adaptiveDuration)})}else{r.plugin.find(".ps-current").css("height",t);r.plugin.find(".ps-list > li").css("height",i)}},100)}else{r.plugin.find(".ps-current").css("height",t);r.plugin.find(".ps-list > li").css("height",i)}if(r.config.verticalCentering){clearTimeout(r.eventResize);r.eventResize=setTimeout(function(){r.plugin.find(".ps-list > li").each(function(){if(i>50&&e(this).find("img").height()>i){var t=Math.round((e(this).find("img").height()-i)/2);e(this).find("img").css("margin-top",-t)}else{e(this).find("img").css("margin-top","")}});r.plugin.find(".ps-current > ul > li").each(function(){var n=e(this).css("display")=="none"?false:true;if(!n){e(this).show()}if(e(this).show().find("img").height()>t){var r=Math.round((e(this).find("img").height()-t)/2);e(this).find("img").css("margin-top",-r)}else{e(this).find("img").css("margin-top","")}if(!n){e(this).hide()}})},200)}return true};var u=function(){if(r.plugin.width()<=480){r.plugin.addClass("narrow").removeClass("wide")}else{r.plugin.addClass("wide").removeClass("narrow")}return true};var a=function(){r.plugin.removeClass(r.config.mainClassName).addClass("ps-list");r.plugin.wrap('<div class="'+r.config.mainClassName+'"></div>');r.plugin=r.plugin.parent();r.plugin.prepend('<div class="ps-current"><ul></ul><span class="ps-caption"></span></div>');r.slideCount=r.plugin.find(".ps-list > li").length;if(r.slideCount==0){return false}var t=1;r.plugin.find(".ps-list > li").each(function(){var n=s(e(this));n.id=t;r.data.push(n);e(this).addClass("elt_"+n.id);if(n.title){if(e(this).find("span").length==1){if(e(this).find("span").text()==""){e(this).find("span").text(n.title)}}else{e(this).find("img").after("<span>"+n.title+"</span>")}}var i=e('<li class="elt_'+t+'"></li>');if(n.image){i.html('<img src="'+n.image+'" alt="'+(n.title?n.title:"")+'">')}else if(n.thumbnail){i.html('<img src="'+n.thumbnail+'" alt="'+(n.title?n.title:"")+'">')}if(n.link){i.html('<a href="'+n.link+'"'+(n.linkTarget?' target="'+n.linkTarget+'"':"")+">"+i.html()+"</a>")}r.plugin.find(".ps-current > ul").append(i);if(r.config.selectionMode=="mouseOver"){e(this).css("cursor","default").click(function(e){e.preventDefault()}).bind("mouseenter",function(e){f(n.id)});e(this).find("a").css("cursor","default")}else{e(this).css("cursor","pointer").click(function(e){e.preventDefault();f(n.id)})}t++});if(r.config.listPosition=="left"){r.plugin.addClass("listOnTheLeft")}if(r.config.autoSlide){r.plugin.on("mouseenter",function(){clearInterval(r.eventInterval);r.eventInterval=null}).on("mouseleave",function(){l()})}f(1);r.plugin.find(".ps-current > ul > li.elt_1 > img").on("load",function(){u();var e=r.plugin.find(".ps-current > ul > li.elt_1 > img").height();o(e);r.window.resize(function(){var e=r.plugin.find(".ps-current .elt_"+r.currentSlide+" img").height();o(e,r.config.adaptiveHeight);u()})});return true};var f=function(t,n){if(t==r.currentSlide){return false}var i=r.data[t-1];var s=r.plugin.find(".ps-current > ul");if(typeof i=="undefined"){throw new Error("PgwSlider - The element "+t+" is undefined");return false}if(typeof r.config.beforeSlide=="function"){r.config.beforeSlide(t)}r.plugin.find(".ps-list > li").css("opacity","0.6");r.plugin.find(".ps-list > li.elt_"+t).css("opacity","1");s.find("li").not(".elt_"+r.currentSlide).not(".elt_"+t).each(function(){if(typeof e(this).stop=="function"){e(this).stop()}e(this).css("position","").css("z-index",1).hide()});if(typeof r.plugin.find(".ps-current > span").fadeOut=="function"){r.plugin.find(".ps-current > span").fadeOut(r.config.transitionDuration/2)}else{r.plugin.find(".ps-current > span").hide()}if(r.currentSlide>0){var u=s.find(".elt_"+r.currentSlide);if(typeof u.animate!="function"){u.animate=function(e,t,n){u.css(e);if(n){n()}}}if(typeof u.stop=="function"){u.stop()}u.css("position","absolute").animate({opacity:0},r.config.transitionDuration,function(){u.css("position","").css("z-index",1).hide()})}r.currentSlide=t;var a=s.find(".elt_"+t);if(typeof a.animate!="function"){a.animate=function(e,t,n){a.css(e);if(n){n()}}}if(typeof a.stop=="function"){a.stop()}a.css("position","absolute").show().animate({opacity:1},r.config.transitionDuration,function(){a.css("position","").css("z-index",2).show();var e="";if(i.title){e+="<b>"+i.title+"</b>"}if(i.description){if(e!="")e+="<br>";e+=i.description}if(e!=""){if(i.link){e='<a href="'+i.link+'"'+(i.linkTarget?' target="'+i.linkTarget+'"':"")+">"+e+"</a>"}if(typeof r.plugin.find(".ps-current > span").fadeOut=="function"){r.plugin.find(".ps-current > span").html(e).fadeIn(r.config.transitionDuration/2)}else{r.plugin.find(".ps-current > span").html(e).show()}}if(typeof r.config.afterSlide=="function"){r.config.afterSlide(t)}if(r.config.adaptiveHeight){var n=r.plugin.find(".ps-current .elt_"+t+" img").height();o(n,true)}});if(typeof n!="undefined"&&r.config.autoSlide){l()}return true};var l=function(){clearInterval(r.eventInterval);if(r.slideCount>1&&r.config.autoSlide){r.eventInterval=setInterval(function(){if(r.currentSlide+1<=r.slideCount){var e=r.currentSlide+1}else{var e=1}f(e)},r.config.intervalDuration)}return true};r.startSlide=function(){r.config.autoSlide=true;l();return true};r.stopSlide=function(){r.config.autoSlide=false;clearInterval(r.eventInterval);return true};r.getCurrentSlide=function(){return r.currentSlide};r.getSlideCount=function(){return r.slideCount};r.displaySlide=function(e){f(e,true);return true};r.nextSlide=function(){if(r.currentSlide+1<=r.slideCount){var e=r.currentSlide+1}else{var e=1}f(e,true);return true};r.previousSlide=function(){if(r.currentSlide-1>=1){var e=r.currentSlide-1}else{var e=r.slideCount}f(e,true);return true};r.destroy=function(t){clearInterval(r.eventInterval);if(typeof t!="undefined"){r.plugin.find(".ps-list > li").each(function(){e(this).attr("style","").removeClass().css("cursor","").unbind("click").unbind("mouseenter");e(this).find("a").css("cursor","")});r.plugin.find(".ps-list").addClass(r.config.mainClassName).removeClass("ps-list");r.plugin.find(".ps-current").unwrap().remove();r.hide()}else{r.parent().remove()}r.plugin=null;r.data=[];r.config={};r.currentSlide=0;r.slideCount=0;r.eventInterval=null;r.window=null;return true};r.reload=function(t){r.destroy(true);r=this;r.plugin=this;r.window=e(window);r.plugin.show();r.config=e.extend({},n,t);a();if(r.config.autoSlide){l()}return true};i();return this}})(window.Zepto||window.jQuery)
